# QQç¾¤ç›¸å†Œå®šæ—¶å¤‡ä»½å·¥å…·

ä¸€ä¸ªåŸºäº Node.js çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œç”¨äºå®šæ—¶å¤‡ä»½å¤šä¸ª QQ ç¾¤ç›¸å†Œã€‚æ”¯æŒå¢é‡å¤‡ä»½ã€å¹¶å‘ä¸‹è½½ã€å¤±è´¥é‡è¯•ç­‰åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ• **å®šæ—¶å¤‡ä»½** - ä½¿ç”¨ cron è¡¨è¾¾å¼è®¾ç½®è‡ªåŠ¨å¤‡ä»½æ—¶é—´
- ğŸ“¦ **å¤šç¾¤ç»„æ”¯æŒ** - åŒæ—¶å¤‡ä»½å¤šä¸ª QQ ç¾¤çš„ç›¸å†Œ
- ğŸ”„ **å¢é‡å¤‡ä»½** - æ™ºèƒ½è·³è¿‡å·²ä¸‹è½½çš„æ–‡ä»¶ï¼ŒèŠ‚çœå¸¦å®½å’Œå­˜å‚¨
- âš¡ **å¹¶å‘ä¸‹è½½** - æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘ä¸‹è½½ï¼Œæé«˜æ•ˆç‡
- ğŸ” **å¤±è´¥é‡è¯•** - è‡ªåŠ¨é‡è¯•å¤±è´¥çš„ä¸‹è½½ä»»åŠ¡
- ğŸ“Š **è¯¦ç»†æ—¥å¿—** - å®Œæ•´çš„æ“ä½œæ—¥å¿—å’Œç»Ÿè®¡ä¿¡æ¯
- ğŸ’¾ **å¤‡ä»½ç´¢å¼•** - ç»´æŠ¤å¤‡ä»½å†å²è®°å½•ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
- ğŸ¬ **è§†é¢‘æ”¯æŒ** - è‡ªåŠ¨ä¸‹è½½ç›¸å†Œä¸­çš„ç…§ç‰‡å’Œè§†é¢‘

## ğŸ“‹ å‰ç½®è¦æ±‚

- Node.js >= 14.0.0
- npm æˆ– yarn
- æœ‰æ•ˆçš„ QQ è´¦å·å’Œè®¿é—®ç¾¤ç›¸å†Œçš„æƒé™

## ğŸš€ å®‰è£…

### 1. å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®

```bash
cd qq-album-scheduler
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. é¦–æ¬¡è¿è¡Œ - è‡ªåŠ¨ç™»å½•

**æ¨èæ–¹å¼ï¼šè‡ªåŠ¨ç™»å½•**

é¦–æ¬¡è¿è¡Œæ—¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ä¾›æ‚¨ç™»å½•ï¼š

```bash
npm start
```

æˆ–æ‰‹åŠ¨è§¦å‘ç™»å½•ï¼š

```bash
node src/index.js --login
```

ç™»å½•æµç¨‹ï¼š
1. ç¨‹åºè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
2. åœ¨æµè§ˆå™¨ä¸­ç™»å½•æ‚¨çš„QQè´¦å·ï¼ˆæ”¯æŒæ‰«ç æˆ–è´¦å·å¯†ç ï¼‰
3. ç™»å½•æˆåŠŸåï¼Œç¨‹åºè‡ªåŠ¨è·å–å¹¶ä¿å­˜è®¤è¯ä¿¡æ¯åˆ° `.env` æ–‡ä»¶
4. æµè§ˆå™¨è‡ªåŠ¨å…³é—­ï¼Œç¨‹åºç»§ç»­è¿è¡Œ

> ğŸ’¡ **æç¤º**: è®¤è¯ä¿¡æ¯ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œä¸‹æ¬¡è¿è¡Œæ— éœ€é‡æ–°ç™»å½•

**æ›¿ä»£æ–¹å¼ï¼šæ‰‹åŠ¨é…ç½®ï¼ˆé«˜çº§ç”¨æˆ·ï¼‰**

å¦‚æœæ‚¨preferæ‰‹åŠ¨é…ç½®æˆ–è‡ªåŠ¨ç™»å½•å¤±è´¥ï¼Œå¯ä»¥ï¼š

1. å¤åˆ¶ `.env.example` åˆ° `.env`ï¼š
   ```bash
   cp .env.example .env
   ```

2. æ‰‹åŠ¨è·å–QQè®¤è¯ä¿¡æ¯ï¼š
   - ä½¿ç”¨æµè§ˆå™¨ç™»å½• [QQç©ºé—´](https://qzone.qq.com/)
   - æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
   - åˆ‡æ¢åˆ° "Network" æ ‡ç­¾
   - åˆ·æ–°é¡µé¢ï¼Œæ‰¾åˆ°ä»»æ„è¯·æ±‚
   - åœ¨è¯·æ±‚å¤´ä¸­æ‰¾åˆ° `Cookie` å­—æ®µï¼Œå¤åˆ¶å®Œæ•´å†…å®¹åˆ° `QQ_COOKIES`
   - åœ¨ Cookie ä¸­æ‰¾åˆ° `p_skey=xxx` çš„å€¼ï¼Œå¤åˆ¶åˆ° `QQ_P_SKEY`
   - åœ¨ Cookie ä¸­æ‰¾åˆ° `p_uin=oXXXXXXXX` çš„å€¼ï¼Œæå–æ•°å­—éƒ¨åˆ†åˆ° `QQ_UIN`

3. ç¼–è¾‘ `.env` æ–‡ä»¶å¡«å†™è·å–çš„ä¿¡æ¯

### 4. é…ç½®ç¾¤ç»„ä¿¡æ¯

å¤åˆ¶ `config.example.json` åˆ° `config.json` å¹¶é…ç½®è¦å¤‡ä»½çš„ç¾¤ç»„ï¼š

```bash
cp config.example.json config.json
```

ç¼–è¾‘ `config.json`ï¼Œæ·»åŠ æ‚¨è¦å¤‡ä»½çš„QQç¾¤ï¼š

```json
{
  "groups": [
    {
      "id": "123456789",
      "name": "æˆ‘çš„ç¾¤ç»„1",
      "enabled": true
    }
  ],
  "schedule": {
    "enabled": true,
    "cron": "0 2 * * *",
    "description": "æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½"
  }
}
```

> ğŸ’¡ **å¦‚ä½•è·å–ç¾¤å·**: åœ¨QQä¸­æ‰“å¼€ç¾¤èµ„æ–™å¡ï¼Œç¾¤å·æ˜¾ç¤ºåœ¨ç¾¤åç§°ä¸‹æ–¹

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### é¦–æ¬¡ç™»å½•

ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶ï¼Œè¿è¡Œç¨‹åºä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è¿›è¡Œç™»å½•ï¼š

```bash
npm start
```

åç»­å¦‚éœ€é‡æ–°ç™»å½•ï¼ˆå¦‚Cookieè¿‡æœŸï¼‰ï¼š

```bash
node src/index.js --login
```

### å®šæ—¶å¤‡ä»½æ¨¡å¼

å¯åŠ¨å®šæ—¶å¤‡ä»½æœåŠ¡ï¼š

```bash
npm start
```

æˆ–ç›´æ¥è¿è¡Œï¼š

```bash
node src/index.js
```

åå°è¿è¡Œï¼ˆå®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼‰ï¼š

```bash
npm run start:daemon
```

### æ‰‹åŠ¨å¤‡ä»½æ¨¡å¼

æ‰§è¡Œä¸€æ¬¡æ€§å¤‡ä»½ï¼š

```bash
npm run backup
```

æˆ–ï¼š

```bash
node src/index.js --manual
```

### å¤‡ä»½æŒ‡å®šç¾¤ç»„

åªå¤‡ä»½æŸä¸ªç¾¤ç»„ï¼š

```bash
node src/index.js --group 123456789
```

### æµ‹è¯•æ¨¡å¼

æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®ï¼ˆä¸å®é™…ä¸‹è½½ï¼‰ï¼š

```bash
npm test
```

æˆ–ï¼š

```bash
node src/index.js --dry-run
```

## âš™ï¸ é…ç½®è¯´æ˜

### å®šæ—¶è®¡åˆ’ (schedule)

ä½¿ç”¨ cron è¡¨è¾¾å¼é…ç½®æ‰§è¡Œæ—¶é—´ï¼š

```
* * * * *
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€ æ˜ŸæœŸå‡  (0-7, 0å’Œ7éƒ½è¡¨ç¤ºå‘¨æ—¥)
â”‚ â”‚ â”‚ â””â”€â”€â”€ æœˆä»½ (1-12)
â”‚ â”‚ â””â”€â”€â”€â”€â”€ æ—¥æœŸ (1-31)
â”‚ â””â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0-59)
```

å¸¸ç”¨ç¤ºä¾‹ï¼š

- `0 2 * * *` - æ¯å¤©å‡Œæ™¨2ç‚¹
- `0 */6 * * *` - æ¯6å°æ—¶
- `0 0 * * 0` - æ¯å‘¨æ—¥åˆå¤œ
- `0 0 1 * *` - æ¯æœˆ1å·åˆå¤œ

### ä¸‹è½½è®¾ç½® (download)

```json
{
  "download": {
    "maxConcurrent": 3,      // æœ€å¤§å¹¶å‘ä¸‹è½½æ•°
    "retryAttempts": 3,      // å¤±è´¥é‡è¯•æ¬¡æ•°
    "retryDelay": 2000,      // é‡è¯•å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
    "timeout": 30000         // ä¸‹è½½è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  }
}
```

### å­˜å‚¨è®¾ç½® (storage)

```json
{
  "storage": {
    "basePath": "./backups",     // å¤‡ä»½æ ¹ç›®å½•
    "organizeBy": "group",       // æŒ‰ç¾¤ç»„ç»„ç»‡
    "keepStructure": true        // ä¿æŒç›®å½•ç»“æ„
  }
}
```

### å¢é‡å¤‡ä»½ (incremental)

```json
{
  "incremental": {
    "enabled": true,        // å¯ç”¨å¢é‡å¤‡ä»½
    "skipExisting": true    // è·³è¿‡å·²å­˜åœ¨çš„æ–‡ä»¶
  }
}
```

### æ—¥å¿—è®¾ç½® (logging)

```json
{
  "logging": {
    "level": "info",        // æ—¥å¿—çº§åˆ«: debug, info, warn, error
    "console": true,        // æ§åˆ¶å°è¾“å‡º
    "file": true,           // æ–‡ä»¶è¾“å‡º
    "maxFiles": "14d"       // æ—¥å¿—ä¿ç•™æ—¶é—´
  }
}
```

## ğŸ“ ç›®å½•ç»“æ„

å¤‡ä»½æ–‡ä»¶ç»„ç»‡ç»“æ„ï¼š

```
backups/
â”œâ”€â”€ 123456789_æˆ‘çš„ç¾¤ç»„1/
â”‚   â”œâ”€â”€ ç›¸å†Œåç§°1/
â”‚   â”‚   â”œâ”€â”€ .backup_index.json
â”‚   â”‚   â”œâ”€â”€ photo1.jpg
â”‚   â”‚   â”œâ”€â”€ photo2.jpg
â”‚   â”‚   â””â”€â”€ video1.mp4
â”‚   â””â”€â”€ ç›¸å†Œåç§°2/
â”‚       â””â”€â”€ ...
â””â”€â”€ 987654321_æˆ‘çš„ç¾¤ç»„2/
    â””â”€â”€ ...
```

## ğŸ“Š æ—¥å¿—æ–‡ä»¶

æ—¥å¿—ä¿å­˜åœ¨ `logs/` ç›®å½•ï¼š

- `qq-album-YYYY-MM-DD.log` - å®Œæ•´æ—¥å¿—
- `error-YYYY-MM-DD.log` - ä»…é”™è¯¯æ—¥å¿—

## ğŸ”§ æ•…éšœæ’é™¤

### è®¤è¯å¤±è´¥

**é—®é¢˜**: æç¤º "âŒ QQè®¤è¯ä¿¡æ¯æœªé…ç½®æˆ–æ— æ•ˆ"

**è§£å†³æ–¹æ³•**:
1. ç¡®è®¤ `.env` æ–‡ä»¶ä¸­çš„ Cookie æ˜¯æœ€æ–°çš„
2. é‡æ–°ç™»å½• QQ ç©ºé—´è·å–æ–°çš„ Cookie
3. ç¡®ä¿ Cookie åŒ…å« `p_skey` å’Œ `p_uin` å­—æ®µ

### æ— è®¿é—®æƒé™

**é—®é¢˜**: ä¸‹è½½æ—¶æç¤º "æ— è®¿é—®æƒé™"

**è§£å†³æ–¹æ³•**:
1. ç¡®è®¤ä½ çš„ QQ è´¦å·åœ¨è¯¥ç¾¤ä¸­
2. ç¡®è®¤ä½ æœ‰æŸ¥çœ‹è¯¥ç¾¤ç›¸å†Œçš„æƒé™
3. ç¾¤ç®¡ç†å‘˜å¯èƒ½é™åˆ¶äº†ç›¸å†Œè®¿é—®

### ä¸‹è½½é€Ÿåº¦æ…¢

**è§£å†³æ–¹æ³•**:
1. å¢åŠ å¹¶å‘ä¸‹è½½æ•° (`maxConcurrent`)
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. é¿å…åœ¨é«˜å³°æ—¶æ®µè¿è¡Œ

### ä¸‹è½½å¤±è´¥

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å¢åŠ é‡è¯•æ¬¡æ•° (`retryAttempts`)
3. å¢åŠ è¶…æ—¶æ—¶é—´ (`timeout`)
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—äº†è§£å…·ä½“åŸå› 

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### Windows è®¡åˆ’ä»»åŠ¡

å¦‚æœä¸æƒ³é•¿æœŸè¿è¡Œç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨ Windows è®¡åˆ’ä»»åŠ¡ï¼š

1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"
2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
3. è®¾ç½®è§¦å‘å™¨ï¼ˆæ—¶é—´ï¼‰
4. æ“ä½œé€‰æ‹©"å¯åŠ¨ç¨‹åº"
5. ç¨‹åºå¡«å†™ï¼š`node`
6. å‚æ•°å¡«å†™ï¼š`"C:\path\to\qq-album-scheduler\src\index.js" --manual`

### Linux/Mac Crontab

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œï¼‰
0 2 * * * cd /path/to/qq-album-scheduler && node src/index.js --manual
```

### Docker éƒ¨ç½²

åˆ›å»º `Dockerfile`ï¼ˆç¤ºä¾‹ï¼‰ï¼š

```dockerfile
FROM node:16-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install --production
COPY . .
CMD ["node", "src/index.js"]
```

æ„å»ºå’Œè¿è¡Œï¼š

```bash
docker build -t qq-album-scheduler .
docker run -d --name qq-backup \
  -v ./backups:/app/backups \
  -v ./config.json:/app/config.json \
  -v ./.env:/app/.env \
  qq-album-scheduler
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Cookie æœ‰æ•ˆæœŸ**: QQ Cookie ä¼šè¿‡æœŸï¼Œå»ºè®®å®šæœŸæ›´æ–°
2. **å­˜å‚¨ç©ºé—´**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å­˜å‚¨å¤‡ä»½
3. **ç½‘ç»œç¨³å®š**: å»ºè®®åœ¨ç½‘ç»œç¨³å®šçš„ç¯å¢ƒè¿è¡Œ
4. **å¤‡ä»½é¢‘ç‡**: ä¸å»ºè®®è®¾ç½®è¿‡é«˜çš„å¤‡ä»½é¢‘ç‡ï¼Œé¿å…å¯¹ QQ æœåŠ¡å™¨é€ æˆå‹åŠ›
5. **éšç§ä¿æŠ¤**: `.env` å’Œ `config.json` åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦ä¸Šä¼ åˆ°å…¬å¼€ä»“åº“

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

æœ¬é¡¹ç›®å‚è€ƒäº†ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [QQ-Group-Albums-Downloader](https://github.com/ShunCai/QQ-Group-Albums-Downloader)
- [QQGroupAlbumDownload](https://github.com/lihengdao/QQGroupAlbumDownload)
